<div class="modal-header border-0 pb-0">
    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
</div>

<div class="modal-body pt-0">
    <h3 class="fw-bold mb-1">{{ drill.title }}</h3>
    <p class="text-muted small mb-3">
        Subido por <span class="fw-bold text-dark">{{ drill.author.name }}</span> â€¢ {{ drill.date_posted.strftime('%d/%m/%Y') }}
    </p>

    <div class="mb-4 rounded overflow-hidden shadow-sm bg-light text-center">
        
        {% if media_type == 'video_file' %}
            <div class="ratio ratio-16x9">
                <video controls autoplay class="w-100">
                    <source src="{{ url_for('static', filename='uploads/' + drill.media_file) }}" type="video/mp4">
                    Tu navegador no soporta vÃ­deos.
                </video>
            </div>

        {% elif media_type == 'image_file' %}
            <a href="{{ url_for('static', filename='uploads/' + drill.media_file) }}" target="_blank" title="Haz clic para ampliar">
                <img src="{{ url_for('static', filename='uploads/' + drill.media_file) }}" class="img-fluid w-100" style="object-fit: contain; max-height: 500px;">
            </a>
            <p class="text-center text-muted small mt-1 mb-0"><i class="bi bi-zoom-in"></i> Haz clic en la foto para ampliar</p>

        {% elif media_type == 'youtube' %}
            <div class="ratio ratio-16x9">
                <iframe src="https://www.youtube.com/embed/{{ drill.external_link|get_youtube_id }}?autoplay=1" allowfullscreen></iframe>
            </div>

        {% elif media_type == 'link' %}
            <div class="p-3 text-center">
                <img src="{{ url_for('static', filename='uploads/default_link_image.jpg') }}" 
                     class="img-fluid rounded mb-3" style="max-height: 200px;"
                     onerror="this.style.display='none'">
                
                <h5 class="mt-2 text-dark">Este ejercicio es un enlace externo</h5>
                <a href="{{ drill.external_link }}" target="_blank" class="btn btn-primary mt-2 px-4 fw-bold">
                    Abrir enlace <i class="bi bi-box-arrow-up-right ms-2"></i>
                </a>
            </div>
        {% endif %}
    </div>

    <div class="px-2">
        {% if drill.description %}
            <h6 class="fw-bold text-secondary">DescripciÃ³n</h6>
            <p class="text-dark" style="white-space: pre-wrap;">{{ drill.description }}</p>
        {% endif %}

        {% if drill.external_link and media_type != 'link' and media_type != 'youtube' %}
            <div class="mt-4 p-3 bg-light rounded border border-warning border-opacity-25">
                <p class="mb-2 small fw-bold text-muted">ðŸ”— Recurso adicional:</p>
                <a href="{{ drill.external_link }}" target="_blank" class="btn btn-outline-dark w-100">
                    <i class="bi bi-box-arrow-up-right"></i> Ir al enlace original
                </a>
            </div>
        {% endif %}
    </div>

    <div class="mt-4 pt-3 border-top">
        {% for tag in drill.primary_tags %}
            <span class="badge bg-primary bg-opacity-10 text-primary border border-primary border-opacity-25 me-1">{{ tag.name }}</span>
        {% endfor %}
    </div>
</div>

<div class="modal-footer bg-light">
    <div class="d-flex w-100 justify-content-between align-items-center">
        <div>
            {% if drill.user_id == current_user.id or current_user.is_admin %}
                <a href="/edit/{{ drill.id }}" class="btn btn-sm btn-outline-warning me-2" title="Editar">
                    <i class="bi bi-pencil-square"></i> Editar
                </a>
                <a href="/delete/{{ drill.id }}" class="btn btn-sm btn-outline-danger" onclick="return confirm('Â¿Seguro que quieres borrarlo?');" title="Borrar">
                    <i class="bi bi-trash"></i>
                </a>
            {% endif %}
        </div>

        <div class="d-flex gap-2">
            <a href="/toggle_practice/{{ drill.id }}" class="btn btn-light border {% if drill in current_user.mochila %}text-success fw-bold{% else %}text-muted{% endif %}">
                <i class="bi bi-basket{% if drill in current_user.mochila %}-fill{% endif %}"></i>
            </a>
            
            <a href="/toggle_fav/{{ drill.id }}" class="btn btn-light border {% if drill in current_user.favoritos %}text-danger fw-bold{% else %}text-muted{% endif %}">
                <i class="bi bi-heart{% if drill in current_user.favoritos %}-fill{% endif %}"></i>
            </a>
            
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
        </div>
    </div>
</div>