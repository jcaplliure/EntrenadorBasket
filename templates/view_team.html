<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Gesti칩n {{ team.name }}</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <style>
        .nav-tabs .nav-link.active { font-weight: bold; color: #0d6efd; border-bottom: 3px solid #0d6efd; background: transparent; }
        .nav-tabs .nav-link { color: #6c757d; border: none; }
    </style>
</head>
<body class="bg-light">
    <nav class="navbar navbar-dark bg-primary mb-4 shadow-sm">
        <div class="container">
            <span class="navbar-brand fw-bold">
                {% if team.logo_file %}<img src="{{ url_for('static', filename='uploads/' + team.logo_file) }}" width="30" height="30" class="rounded-circle me-2">{% endif %}
                {{ team.name }}
            </span>
            <div>
                <a href="/team/{{ team.id }}/public" target="_blank" class="btn btn-warning btn-sm fw-bold me-2"><i class="bi bi-trophy-fill"></i> Portal</a>
                <a href="/my_teams" class="btn btn-light btn-sm text-primary fw-bold">Volver</a>
            </div>
        </div>
    </nav>
    <div class="container pb-5">
        <ul class="nav nav-tabs mb-4" id="teamTab" role="tablist">
            <li class="nav-item"><button class="nav-link active" data-bs-toggle="tab" data-bs-target="#players">游논 Plantilla</button></li>
            <li class="nav-item"><button class="nav-link" data-bs-toggle="tab" data-bs-target="#staff">游녮 Staff</button></li>
            <li class="nav-item"><button class="nav-link" data-bs-toggle="tab" data-bs-target="#settings">丘뙖잺 Ajustes</button></li>
        </ul>
        <div class="tab-content">
            <div class="tab-pane fade show active" id="players">
                <div class="row g-3 mb-3">
                    <div class="col-md-6">
                        <div class="card p-3 border-0 shadow-sm h-100">
                            <h6 class="fw-bold text-muted mb-2">Nuevo Jugador Manual</h6>
                            <form method="POST" enctype="multipart/form-data" class="d-flex gap-2">
                                <input type="number" name="dorsal" class="form-control" placeholder="#" style="width: 70px;" required>
                                <input type="text" name="name" class="form-control" placeholder="Nombre" required>
                                <button type="submit" class="btn btn-primary fw-bold">+</button>
                            </form>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="card p-3 border-0 shadow-sm h-100 bg-white">
                            <h6 class="fw-bold text-primary mb-2"><i class="bi bi-file-earmark-spreadsheet"></i> Importar CSV</h6>
                            <form action="/import_players/{{ team.id }}" method="POST" enctype="multipart/form-data" class="d-flex gap-2 align-items-center">
                                <input type="file" name="csv_file" class="form-control form-control-sm" accept=".csv" required>
                                <button type="submit" class="btn btn-outline-primary btn-sm fw-bold">Subir</button>
                            </form>
                        </div>
                    </div>
                </div>
                <div class="card border-0 shadow-sm">
                    <div class="list-group list-group-flush">
                        {% for player in team.players|sort(attribute='dorsal') %}
                        <div class="list-group-item d-flex justify-content-between align-items-center p-3">
                            <div><span class="badge bg-dark me-3" style="width: 40px;">{{ player.dorsal }}</span>{{ player.name }}</div>
                            <div class="d-flex gap-2">
                                <a href="/edit_player/{{ player.id }}" class="btn btn-outline-secondary btn-sm"><i class="bi bi-pencil"></i></a>
                                <a href="/delete_player/{{ player.id }}" class="btn btn-outline-danger btn-sm" onclick="return confirm('쮹orrar?')"><i class="bi bi-trash"></i></a>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
            <div class="tab-pane fade" id="staff">
                <div class="card border-0 shadow-sm p-4">
                     {% if is_owner %}
                    <form action="/manage_staff/{{ team.id }}" method="POST" class="d-flex gap-2 mb-4 bg-light p-3 rounded">
                        <input type="hidden" name="action" value="invite">
                        <input type="email" name="email" class="form-control" placeholder="Email del entrenador ayudante" required>
                        <button type="submit" class="btn btn-primary fw-bold">Invitar</button>
                    </form>
                    {% endif %}
                    <ul class="list-group">
                        <li class="list-group-item bg-light">{{ team.owner.name }} <span class="badge bg-warning text-dark">Owner</span></li>
                        {% for member in team.staff %}
                        <li class="list-group-item d-flex justify-content-between">
                            {{ member.email }}
                            {% if is_owner %}
                            <form action="/manage_staff/{{ team.id }}" method="POST" class="d-inline" onsubmit="return confirm('쮼liminar?')">
                                <input type="hidden" name="action" value="remove">
                                <input type="hidden" name="staff_id" value="{{ member.id }}">
                                <button class="btn btn-outline-danger btn-sm border-0"><i class="bi bi-x-lg"></i></button>
                            </form>
                            {% endif %}
                        </li>
                        {% endfor %}
                    </ul>
                </div>
            </div>
            <div class="tab-pane fade" id="settings">
                <div class="card border-0 shadow-sm p-4">
                    <form action="/edit_team_settings/{{ team.id }}" method="POST" enctype="multipart/form-data">
                        <h6 class="fw-bold text-primary mb-3">Datos B치sicos</h6>
                        <div class="mb-3"><input type="text" name="name" class="form-control" value="{{ team.name }}" required></div>
                        <div class="mb-4"><input type="file" name="logo" class="form-control"></div>

                        <h6 class="fw-bold text-primary mb-3">Configuraci칩n de Partidos</h6>
                        <div class="mb-4 bg-light p-3 rounded">
                            <label class="form-label fw-bold">N칰mero de Periodos</label>
                            <select name="quarters" class="form-select">
                                {% for i in range(2, 9) %}
                                <option value="{{ i }}" {% if team.quarters == i %}selected{% endif %}>{{ i }} Periodos</option>
                                {% endfor %}
                            </select>
                        </div>
                        <h6 class="fw-bold text-primary mb-3">Ranking P칰blico</h6>
                         <div class="row g-2 mb-4">
                            <div class="col-6">
                                <select name="visibility_mode" class="form-select form-select-sm">
                                    <option value="fixed" {% if team.visibility_mode == 'fixed' %}selected{% endif %}>Top Fijo</option>
                                    <option value="percent" {% if team.visibility_mode == 'percent' %}selected{% endif %}>Porcentaje</option>
                                </select>
                            </div>
                            <div class="col-6"><input type="number" name="visibility_top_x" class="form-control form-control-sm" value="{{ team.visibility_top_x }}"></div>
                        </div>
                        <div class="d-grid"><button type="submit" class="btn btn-success fw-bold">Guardar Cambios</button></div>
                    </form>
                </div>
            </div>
        </div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>