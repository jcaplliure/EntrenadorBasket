<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Nuevo Partido</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">

    <div class="container py-4">
        <div class="card shadow border-0" style="max-width: 500px; margin: auto;">
            <div class="card-header bg-danger text-white fw-bold text-center py-3">
                üèÄ Empezar Partido
            </div>
            <div class="card-body p-4">
                <form action="/new_match" method="POST">
                    
                    <div class="mb-3">
                        <label class="form-label fw-bold">Rival</label>
                        <input type="text" name="opponent" class="form-control form-control-lg" placeholder="Nombre del equipo contrario" required autofocus>
                    </div>

                    <div class="mb-3">
                        <label class="form-label fw-bold">Mi Equipo</label>
                        <select name="team_id" id="teamSelect" class="form-select form-select-lg" onchange="updateQuarters()" required>
                            {% for team in teams %}
                            <option value="{{ team.id }}" data-quarters="{{ team.quarters }}">{{ team.name }}</option>
                            {% endfor %}
                        </select>
                    </div>

                    <div class="mb-4 bg-light p-3 rounded">
                        <label class="form-label fw-bold small text-muted">Estructura del Partido</label>
                        <div class="d-flex gap-2">
                            <input type="radio" class="btn-check" name="quarters" id="q4" value="4" checked>
                            <label class="btn btn-outline-secondary flex-fill" for="q4">4 Cuartos</label>

                            <input type="radio" class="btn-check" name="quarters" id="q6" value="6">
                            <label class="btn btn-outline-secondary flex-fill" for="q6">6 Sextos</label>

                            <input type="radio" class="btn-check" name="quarters" id="q2" value="2">
                            <label class="btn btn-outline-secondary flex-fill" for="q2">2 Partes</label>
                        </div>
                    </div>

                    <div class="mb-4">
                        <label class="form-label fw-bold">Convocatoria Inicial</label>
                        <p class="small text-muted mb-2">Selecciona qui√©nes vienen hoy. Podr√°s cambiarlos luego.</p>
                        <div id="roster-container" class="border rounded p-2" style="max-height: 200px; overflow-y: auto;">
                           <div class="text-center text-muted small py-3">Cargando jugadores...</div>
                        </div>
                    </div>

                    <div class="d-grid gap-2">
                        <button type="submit" class="btn btn-danger btn-lg fw-bold">Saltar a Pista</button>
                        <a href="/" class="btn btn-light">Cancelar</a>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script>
        // Datos de equipos y jugadores incrustados desde Flask
        const teamsData = {
            {% for team in teams %}
            "{{ team.id }}": {
                quarters: {{ team.quarters }},
                players: [
                    {% for p in team.players %}
                    {id: {{ p.id }}, name: "{{ p.name }}", dorsal: {{ p.dorsal }}},
                    {% endfor %}
                ]
            },
            {% endfor %}
        };

        function updateQuarters() {
            const teamId = document.getElementById('teamSelect').value;
            const data = teamsData[teamId];
            
            // 1. Update Quarters Radio
            if(data.quarters === 4) document.getElementById('q4').checked = true;
            else if(data.quarters === 6) document.getElementById('q6').checked = true;
            else if(data.quarters === 2) document.getElementById('q2').checked = true;

            // 2. Update Roster List
            const rosterDiv = document.getElementById('roster-container');
            rosterDiv.innerHTML = '';
            
            // Ordenar por dorsal
            data.players.sort((a,b) => a.dorsal - b.dorsal);

            data.players.forEach(p => {
                const html = `
                    <div class="form-check border-bottom py-2">
                        <input class="form-check-input" type="checkbox" name="roster" value="${p.id}" id="p${p.id}" checked>
                        <label class="form-check-label w-100 cursor-pointer" for="p${p.id}">
                            <span class="badge bg-secondary me-2" style="width:30px">${p.dorsal}</span> ${p.name}
                        </label>
                    </div>
                `;
                rosterDiv.insertAdjacentHTML('beforeend', html);
            });
        }

        // Init on load
        window.onload = updateQuarters;
    </script>
</body>
</html>